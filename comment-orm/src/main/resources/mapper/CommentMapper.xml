<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chlcn.mapper.CommentMapper">
    <resultMap id="CommentResultMap" type="com.chlcn.entity.CommentEntity">
        <id property="id" column="id" />
        <result property="userId" column="user_id" />
        <result property="module" column="module" />
        <result property="resourceId" column="resource_id" />
        <result property="content" column="content" />
        <result property="status" column="status" />
        <result property="score" column="score" />
        <result property="starNum" column="star_num" />
        <result property="isDelete" column="is_delete" />
        <result property="createTime" column="create_time" />
        <result property="updateTime" column="update_time" />
    </resultMap>
    <insert id="addComment" parameterType="com.chlcn.entity.CommentEntity">
        insert into tb_comment(
            module,
            resource_id,
            user_id,
            content,
            status,
            is_delete,
            create_time,
            update_time,
            score,
            star_num
        )values(
                   #{module},
                   #{resourceId},
                   #{userId},
                   #{content},
                   #{status},
                   #{isDelete},
                   #{createTime},
                   #{updateTime},
                   #{score},
                   #{starNum}
               )
    </insert>
    <delete id="deleteCommentById" parameterType="java.lang.Long">
        delete from tb_comment where id=#{id}
    </delete>

    <select id="queryCommentByParam" resultMap="CommentResultMap" parameterType="com.chlcn.entity.CommentParam">
        select * from tb_comment
        <where>
            <if test="isDelete!=null">
                and is_delete=#{isDelete}
            </if>
            <if test="module!=null">
                and module=#{module}
            </if>
            <if test="resourceId!=null">
                and resource_id=#{resourceId}
            </if>
            <if test="score!=null">
                and score=#{score}
            </if>
        </where>
        <if test="orderBy!=null and orderBy!=''">
            order by ${orderBy}
            <if test="orderDirection!=null and orderDirection!=''">
                ${orderDirection}
            </if>
        </if>
        <if test="limit != null">
            <if test="offset != null">
                limit ${offset}, ${limit}
            </if>
            <if test="offset == null">
                limit ${limit}
            </if>
        </if>
    </select>
    <select id="countCommentByParam" resultType="java.lang.Integer" parameterType="com.chlcn.entity.CommentParam">
        select count(*) from tb_comment
        <where>
            <if test="isDelete!=null">
                and is_delete=#{isDelete}
            </if>
            <if test="module!=null">
                and module=#{module}
            </if>
            <if test="resourceId!=null">
                and resource_id=#{resourceId}
            </if>
            <if test="score!=null">
                and score=#{score}
            </if>
        </where>
    </select>

</mapper>